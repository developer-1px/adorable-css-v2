<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdorableCSS v2 - Failed Classes Detection Demo</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 20px; }
        .example-box { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        button { margin: 5px; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>AdorableCSS v2 - Failed Classes Detection Demo</h1>
    
    <div class="example-box">
        <h2>테스트 1: 유효한 클래스들</h2>
        <div class="hbox(pack) p(20) bg(blue) c(white) r(8)">
            이 박스는 모든 유효한 클래스를 사용합니다
        </div>
    </div>

    <div class="example-box">
        <h2>테스트 2: 유효하지 않은 클래스들 포함</h2>
        <div class="vbox(pack) invalid-class p(15) unknown-utility bg(red) c(white) missing-feature navigation">
            이 박스는 일부 유효하지 않은 클래스를 포함합니다 (빈 CSS 규칙은 생성되지 않음)
        </div>
    </div>

    <div class="example-box">
        <h2>수동 테스트</h2>
        <button onclick="testClasses()">클래스 분석 실행</button>
        <button onclick="addInvalidClass()">유효하지 않은 클래스 추가</button>
        <button onclick="addValidClass()">유효한 클래스 추가</button>
        <div id="test-target" class="p(10) bg(gray)">테스트 대상</div>
        <div id="results" style="margin-top: 10px; white-space: pre-wrap; font-family: monospace;"></div>
    </div>

    <!-- AdorableCSS v2 CDN -->
    <script src="./dist/index.global.js"></script>
    
    <script>
        // 디버그 모드로 초기화
        AdorableCSSV2.init({ debug: true });

        function testClasses() {
            const testClasses = [
                'hbox(pack)', 'vbox(pack)', 'p(20)', 'bg(blue)', 'c(white)', 'r(8)',
                'invalid-class', 'unknown-utility', 'missing-feature', 'fake-rule', 'navigation',
                'font(16)', 'bold', 'shadow(lg)', 'gap(10)', 'w(300)'
            ];

            const analysis = AdorableCSSV2.analyze(testClasses);
            
            document.getElementById('results').textContent = 
                `분석 결과:\n` +
                `총 클래스: ${analysis.total}\n` +
                `성공률: ${analysis.successRate}\n\n` +
                `유효한 클래스 (${analysis.successful.length}개):\n${analysis.successful.join(', ')}\n\n` +
                `실패한 클래스 (${analysis.failed.length}개):\n${analysis.failed.join(', ')}`;
        }

        let counter = 0;
        function addInvalidClass() {
            const target = document.getElementById('test-target');
            target.classList.add(`invalid-${++counter}`);
        }

        function addValidClass() {
            const validClasses = ['bold', 'italic', 'pointer', 'transition', 'fit', 'center'];
            const target = document.getElementById('test-target');
            const randomClass = validClasses[Math.floor(Math.random() * validClasses.length)];
            target.classList.add(randomClass);
        }

        // AdorableCSSV2 객체에 analyze 함수 추가 (전역으로 사용하기 위해)
        if (typeof AdorableCSSV2 !== 'undefined') {
            AdorableCSSV2.analyze = function(classes) {
                const failed = classes.filter(className => {
                    const css = AdorableCSSV2.generate([className]);
                    if (!css || css.trim() === '') return true;
                    const cssWithoutWhitespace = css.replace(/\s/g, '');
                    return /^\.[\w\\():-]+\{\}$/.test(cssWithoutWhitespace);
                });
                
                const successful = classes.filter(c => !failed.includes(c));
                const successRate = classes.length === 0 ? '100%' : `${Math.round((successful.length / classes.length) * 100)}%`;
                
                return {
                    total: classes.length,
                    successful,
                    failed,
                    successRate
                };
            };
        }

        console.log('AdorableCSS v2 loaded with debug mode. Check console for failed class warnings.');
    </script>
</body>
</html>